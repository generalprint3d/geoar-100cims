<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>01_PuigBassegoda-2088m - GeoAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body { margin:0; padding:0; overflow:hidden; background:black; }
#camera { position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:1; }
#map { position:fixed; top:0; left:0; width:100%; height:100%; z-index:2; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline muted></video>
<div id="map"></div>

<!-- Leaflet JS CDN -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>

<script>
// ðŸ“· activar cÃ mera
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream => { document.getElementById("camera").srcObject = stream; })
.catch(err => { alert("Error cÃ mera: " + err); });

// ðŸ—ºï¸ mapa base
var map = L.map('map', { zoomControl:true, attributionControl:false }).setView([42.13,1.78],13);
var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

// Carregar KML Ãºnic
const KML_FILE = "01_PuigBassegoda-2088m.kml";

omnivore.kml(KML_FILE)
.on('ready', function(){
    const layer = this;
    layer.eachLayer(function(l){
        if(l.setStyle){
            l.setStyle({
                fill: false,
                fillOpacity: 0,
                color: "#FFAA00",
                weight: 3,
                opacity: 0.8
            });
        }
    });
    map.addLayer(layer);

    setTimeout(()=>{
        const bounds = layer.getBounds();
        if(bounds.isValid()){ map.fitBounds(bounds, { maxZoom: 17 }); }
    }, 100);
})
.on('error', function(e){
    console.error("Error carregant KML", e);
});
</script>

</body>
</html>
