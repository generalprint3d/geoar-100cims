<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<title>100 Cims AR - El Pedr√≥</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
 href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
}

/* üì∑ c√†mera */
#camera {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 1;
}

/* üó∫Ô∏è mapa */
#map {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  background: transparent;
}

/* üéõÔ∏è controls */
#controls {
  position: fixed;
  bottom: 20px;
  left: 20px;
  right: 20px;
  z-index: 999;
  background: rgba(0,0,0,0.5);
  padding: 10px;
  border-radius: 10px;
  color: white;
  font-family: sans-serif;
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline muted></video>
<div id="map"></div>

<div id="controls">
Transpar√®ncia:
<input type="range" id="opacity" min="0" max="1" step="0.05" value="0.7">
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>

<script>

// ===============================
// üì∑ ACTIVAR C√ÄMERA
// ===============================

navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => {
  document.getElementById("camera").srcObject = stream;
})
.catch(err => {
  alert("Error c√†mera: " + err);
});

// ===============================
// üó∫Ô∏è MAPA
// ===============================

var map = L.map('map', {
  zoomControl: true,
  attributionControl: false
});

// ===============================
// üß≠ CAPES BASE
// ===============================

// Topogr√†fic (default)
var icgcTopo = L.tileLayer.wms(
  "https://geoserveis.icgc.cat/icc_mapesmultibase/wms/service?",
  {
    layers: "topo",
    format: "image/png",
    transparent: false,
    opacity: 0.7
  }
).addTo(map);

// Geol√≤gic
var icgcGeo = L.tileLayer.wms(
  "https://geoserveis.icgc.cat/geologia/wms/service?",
  {
    layers: "geologia250m",
    format: "image/png",
    transparent: false,
    opacity: 0.7
  }
);

// Vol americ√†
var icgc1956 = L.tileLayer.wms(
  "https://geoserveis.icgc.cat/icc_ortohistorica/wms/service?",
  {
    layers: "orto1956",
    format: "image/jpeg",
    transparent: false,
    opacity: 0.7
  }
);

// OSM opcional
var osm = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  { opacity: 0.7 }
);

// selector
L.control.layers({
  "ICGC Topogr√†fic": icgcTopo,
  "ICGC Geol√≤gic": icgcGeo,
  "Vol Americ√† 1956-57": icgc1956,
  "OpenStreetMap": osm
}).addTo(map);

// ===============================
// üéöÔ∏è SLIDER OPACITAT
// ===============================

document.getElementById("opacity").addEventListener("input", e => {
  const val = e.target.value;

  icgcTopo.setOpacity(val);
  icgcGeo.setOpacity(val);
  icgc1956.setOpacity(val);
  osm.setOpacity(val);
});

// ===============================
// üìç KML (CANVIA PER CADA CIM)
// ===============================

const KML_FILE = "01_ElPedro_4000m.kml";

omnivore.kml(KML_FILE)
  .on('ready', function () {
    map.fitBounds(this.getBounds());
  })
  .addTo(map);

</script>

</body>
</html>