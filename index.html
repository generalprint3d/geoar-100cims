<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>GeoAR Test - PNG estable</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
html, body { margin:0; padding:0; overflow:hidden; background:black; }
#camera { position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:1; }
#map { position:fixed; top:0; left:0; width:100%; height:100%; z-index:2; background:transparent; }
#controls { position:fixed; bottom:20px; left:20px; right:20px; z-index:999; background:rgba(0,0,0,0.5); padding:10px; border-radius:10px; color:white; font-family:sans-serif; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline muted></video>
<div id="map"></div>

<div id="controls">
Transparència:
<input type="range" id="opacity" min="0" max="1" step="0.05" value="0.7">
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>

<script>
// 1️⃣ activar càmera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
.then(stream => { document.getElementById("camera").srcObject = stream; })
.catch(err => { alert("Error càmera: " + err); });

// 2️⃣ inicialitzar mapa
var map = L.map('map', { zoomControl:true, attributionControl:false }).setView([42.13, 1.78], 13);

// 3️⃣ carregar KML del cim
omnivore.kml('ElPedró.kml').on('ready', function(e){
    var kmlLayer = e.target;
    map.addLayer(kmlLayer); // veure el cercle del KML

    // 4️⃣ afegir PNG transparent sobre el cim
    var overlay = L.imageOverlay(
        'ElPedró.png', 
        kmlLayer.getBounds(),
        { opacity: 0.7 }
    ).addTo(map);

    // 5️⃣ slider opacitat
    document.getElementById("opacity").addEventListener("input", function(ev){
        overlay.setOpacity(ev.target.value);
    });
});
</script>

</body>
</html>